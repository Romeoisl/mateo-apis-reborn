<!DOCTYPE html>
<html>
<head>
  <title>Home - News & APIs</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <header>
    <h1>Welcome to the API Portal</h1>
    <% if (user) { %>
      <p>Hello, <%= user.username %> | <a href="/logout">Logout</a> | <a href="/profile">Profile</a> | <a href="/apitest">Test APIs</a> <% if (user.role === 'admin') { %>| <a href="/admin">Admin</a><% } %></p>
    <% } else { %>
      <a href="/login">Login</a> | <a href="/register">Sign Up</a>
    <% } %>
  </header>
  <main>
    <% if (widgets && widgets.length) { %>
      <section id="widgets">
        <% widgets.forEach(w => { %>
          <div class="api-widget"><%- w %></div>
        <% }) %>
      </section>
    <% } %>
    <h2>Latest News</h2>
    <% news.forEach(n => { %>
      <div class="news">
        <h3><%= n.title %></h3>
        <small>by <%= n.author ? n.author.username : "?" %> on <%= n.date.toLocaleString() %></small>
        <p><%= n.content %></p>
      </div>
    <% }) %>
    <% if (user && user.role === 'admin') { %>
      <form method="post" action="/news">
        <h3>Post News (admin only)</h3>
        <input name="title" placeholder="Title" required>
        <textarea name="content" placeholder="Content" required></textarea>
        <button>Post</button>
      </form>
    <% } %>
  </main>
</body>
</html>
